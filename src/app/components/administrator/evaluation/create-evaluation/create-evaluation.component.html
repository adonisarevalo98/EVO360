

<body class="hold-transition sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
    <div class="wrapper">
        <app-topbar></app-topbar><!-- TopBar -->
        <app-sidebar></app-sidebar>  <!-- ./Sidebar -->
    
      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
           <div class="toast" id="alert_toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-body text-white">
            </div>
          </div>
        <div id="toastsContainerTopRight" class="toasts-top-right fixed"></div>
        <!-- Content Header (Page header) -->
        <div class="content-header">
          <div class="container-fluid">
            <div class="row mb-2">
              <div class="col-sm-6">
                <h1 class="m-0" *ngIf="Route_type=='evaluations'">Crear evaluación</h1>
                <h1 class="m-0" *ngIf="Route_type=='auto-evaluations'">Crear Auto-evaluación</h1>
              </div><!-- /.col -->
    
            </div><!-- /.row -->
                <hr class="border-primary">
          </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->
    
        <!-- Main content -->
        <section class="content">
          <div class="spinner" *ngIf="!load"> <!-- Spinner de carga de datos -->
            <div class="overlay">
              <i class="fas fa-2x fa-sync-alt fa-spin"></i>
            </div>
            </div>
          <div class="container-fluid" *ngIf="load"><!-- Espera a la carga de datos -->
            <!-- Form for evaluations -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <form [formGroup]="form" (ngSubmit)="ConfirmInsert()">
                            <div class="row">
                                <div class="col-md-6 border-right">
                                    <div class="form-group">
                                        <label for="" class="control-label">Descripción</label>
                                        <div class="custom-file">
                                          <textarea class="form-control" id="customFile" name="description" 
                                          [formControl]="description"></textarea>
                                          <div *ngIf="description?.touched ">
                                            <p class="text-center mt-1 text-danger"
                                              *ngIf="description?.errors?.['required']" >
                                              <small>Descripción demasiado extensa!</small>
                                            </p>
                                          </div>  
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label">Fecha de inicio</label>
                                        <input type="datetime-local" required class="form-control" id="formGroupExampleInput"
                                          autocomplete="off" name="start_date"
                                          [formControl]="start_date">
                                            <div *ngIf="start_date?.touched ">
                                              <p class="text-center mt-1 text-danger"
                                                *ngIf="start_date?.errors?.['required']" >
                                                <small>Este campo es obligatorio!</small>
                                              </p>
                                            </div>             
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label">Fecha de cierre</label>
                                       <input type="datetime-local" required class="form-control" id="formGroupExampleInput"
                                         autocomplete="off" name="end_date" [formControl]="end_date">
                                         <div *ngIf="end_date?.touched ">
                                          <p class="text-center mt-1 text-danger"
                                            *ngIf="end_date?.errors?.['required']" >
                                            <small>Este campo es obligatorio!</small>
                                          </p>
                                        </div>              
                                    </div>
                                    <div class="form-group">
                                      <label for="" class="control-label">Plantilla de items</label>
                                      <select class="form-control" required  name="id_template"
                                      [formControl]="template" (change)="TempselectChangeHandler($event)">
                                      <option *ngFor="let temps of question_templates" [value]="temps.id">{{temps.type}}</option>
                                    </select>
                                    <button type="button" [disabled]="(evaluationData.id_template==0)" (click)="Importitems(evaluationData.id_template);
                                    frame.show(); ">Importar plantilla</button> 
                                    <div *ngIf="template?.touched ">
                                      <p class="text-center mt-1 text-danger"
                                        *ngIf="template?.errors?.['required']" >
                                        <small>Este campo es obligatorio!</small>
                                      </p>
                                    </div>     
                                                            
                                  </div>
                                   
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="" class="control-label">Estado de evaluación</label>
                                        <select class="form-control" required  name="status"
                                        [formControl]="status" >
                                        <option *ngFor="let sts of evaluation_status" [value]="sts.id">{{sts.status}}</option>
                                      </select>
                                      <div *ngIf="status?.touched ">
                                        <p class="text-center mt-1 text-danger"
                                          *ngIf="status?.errors?.['required']" >
                                          <small>Este campo es obligatorio!</small>
                                        </p>
                                      </div>                
                                    </div>
                                    <div class="form-group">
                                      <label for="" class="control-label">Empresa</label>
                                      <select class="form-control" required name="id_company"
                                      [formControl]="company" (change)="CompselectChangeHandler($event)">
                                      <option [value]="" selected></option>
                                      <option *ngFor="let companies of companies" [value]="companies.id">{{companies.company}}</option>
                                    </select>
                                    <div *ngIf="company?.touched ">
                                      <p class="text-center mt-1 text-danger"
                                        *ngIf="company?.errors?.['required']" >
                                        <small>Este campo es obligatorio!</small>
                                      </p>
                                    </div>                 
                                  </div>
                                    <div class="form-group">
                                      <label for="" class="control-label">Departamento</label>
                                      <select class="form-control" required autocomplete="off" name="department_id"
                                      [formControl]="department" (change)="DepselectChangeHandler($event)">
                                      <option [value]="" selected></option>
                                      <option *ngFor="let dpts of departments" [value]="dpts.id">{{dpts.department}}</option>
                                    </select>
                                    <div *ngIf="department?.touched ">
                                      <p class="text-center mt-1 text-danger"
                                        *ngIf="department?.errors?.['required']" >
                                        <small>Este campo es obligatorio!</small>
                                      </p>
                                    </div>                  
                                  </div>
                                  <div class="form-group">
                                    <label for="" class="control-label">Seleccione el empleado a evaluar</label>
                                    <select class="form-control" required autocomplete="off" 
                                    name="id_user" [formControl]="id_user" (change)="UserselectChangeHandler($event)">
                                    <option [value]="" selected></option>
                                    <option *ngFor="let usr of  users" [value]="usr.id">{{usr.name+' '+usr.last_name}}</option>
                                  </select>
                                  <div *ngIf="id_user?.touched ">
                                    <p class="text-center mt-1 text-danger"
                                      *ngIf="id_user?.errors?.['required']" >
                                      <small>Este campo es obligatorio!</small>
                                    </p>
                                  </div>                
                                </div>
                                    
                                </div>
                            </div>
                            <hr>
                            <div class="col-lg-12 text-right justify-content-center d-flex">
                              <button type="submit" class="btn btn-primary mr-2" >Crear</button>
                              
                          </div>
                        </form>
                       
                    </div>
                </div>
            </div><!--/. From for evaluations -->

                                  <!-- table -->
                                  <!-- modal form -->
<div mdbModal #frame="mdbModal" class="modal fade left" id="frameModalTop" tabindex="-1" role="dialog"
aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable" role="document">
  <div class="modal-content">
    <div class="modal-header text-center">
      <h4 class="modal-title w-100 font-weight-bold">Items a usar</h4>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="frame.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="card-body">
              
      <mat-form-field>
        <input matInput (keyup)="applyFilter($event.target.value)" 
        placeholder="Escriba algo para filtrar">
      </mat-form-field>

      
      <div class="example-container mat-elevation-z8"><!-- table -->
        <mat-table class="table-bordered" [dataSource]="items" matSort>
           
            <ng-container matColumnDef="#">
                <mat-header-cell *matHeaderCellDef mat-sort-header>#</mat-header-cell>
                <mat-cell *matCellDef="let i=index"> {{i+1}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="Pregunta">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Pregunta</mat-header-cell>
                <mat-cell *matCellDef="let row"> {{row.question}} </mat-cell>
          </ng-container>
  
          <ng-container matColumnDef="Tipo">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Tipo </mat-header-cell>
            <mat-cell  *matCellDef="let row">
                <span *ngIf="row.question_type==0" class='badge'>Pregunta abierta</span>
                <span *ngIf="row.question_type==1" class='badge'>Pregunta cerrada</span>
             </mat-cell>
          </ng-container>

          <ng-container matColumnDef="Criterio">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Criterio</mat-header-cell>
            <mat-cell *matCellDef="let row"> {{row.criterion}} </mat-cell>
          </ng-container>
         
          <mat-header-row *matHeaderRowDef="displayedColumns" class="encabezado"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>
    <mat-paginator [pageSizeOptions]="[5]" [pageSize]="5" [showFirstLastButtons]></mat-paginator>
  </div><!--/. table -->
  <div class="modal-footer d-flex justify-content-center">
    <button mdbBtn color="indigo" class="waves-light" mdbWavesEffect
     (click)="frame.hide()" >Aceptar
    </button>
  </div>
        
  </div>
   </div>
</div>
</div><!-- /. modal form -->
           
            <style>
                img#cimg{
                    height: 15vh;
                    width: 15vh;
                    object-fit: cover;
                    border-radius: 100% 100%;
                }
            </style>


          </div><!--/. container-fluid -->
        </section>
        <!-- /.content -->
      </div>
      <!-- /.content-wrapper -->
    
      <!-- Control Sidebar -->
      <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
      </aside>
      <!-- /.control-sidebar -->
    
      <!-- Main Footer -->
      <app-footer></app-footer>
    </div>
    <!-- ./wrapper -->
    </body>



